<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add New Product</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold text-warning" href="#">ðŸŒ¾ Supplier Panel</a>
    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="supplier-dashboard.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link text-danger" id="logoutBtn" href="#">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <h3 class="card-title text-center mb-4">Add a New Product</h3>
          <form id="addProductForm">
            <div class="mb-3">
              <label for="productName" class="form-label">Product Name</label>
              <input type="text" class="form-control" id="productName" required>
            </div>
            <div class="mb-3">
              <label for="productPrice" class="form-label">Price (per kg)</label>
              <input type="number" class="form-control" id="productPrice" required>
            </div>
            <div class="mb-3">
              <label for="productStock" class="form-label">Stock Quantity (kg)</label>
              <input type="number" class="form-control" id="productStock" required>
            </div>
            <div class="mb-3">
              <label for="productImage" class="form-label">Image URL</label>
              <input type="url" class="form-control" id="productImage" placeholder="https://example.com/image.jpg" required>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">Add Product</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>

<script>
  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAYHdIkhYD0az_6D6awMUTAb40WctEmGCY",
    authDomain: "street-sourcer.firebaseapp.com",
    projectId: "street-sourcer",
    storageBucket: "street-sourcer.appspot.com",
    messagingSenderId: "15894964108",
    appId: "1:15894964108:web:a97b17e9f6ef26552b18a9"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // --- Full JavaScript Logic ---

  // 1. Check if a user is logged in. If not, redirect them.
  auth.onAuthStateChanged((user) => {
    if (!user) {
      console.log("No user logged in, redirecting...");
      window.location.href = "supplier-login.html";
    }
  });

  // 2. Get the form from the HTML
  const addProductForm = document.getElementById("addProductForm");

  // 3. Add a 'submit' event listener to the form
  addProductForm.addEventListener("submit", (e) => {
    e.preventDefault(); // This stops the page from reloading on submit
    
    const user = auth.currentUser; // Get the currently logged-in user

    // 4. Create an object with all the data from the form fields
    const productData = {
      name: document.getElementById("productName").value,
      price: Number(document.getElementById("productPrice").value),
      stock: Number(document.getElementById("productStock").value),
      imageUrl: document.getElementById("productImage").value,
      supplierId: user.uid,       // The logged-in supplier's unique ID
      supplierEmail: user.email,  // The logged-in supplier's email
      supplierName: "Greenleaf Farms" // This is hardcoded for now
    };

    // 5. Use the Firestore 'add' command to save the data
    // This creates a new document in the 'products' collection
    db.collection("products").add(productData)
      .then((docRef) => {
        // This part runs if the data was saved successfully
        console.log("Product added with ID: ", docRef.id);
        alert("Product added successfully!");
        window.location.href = "supplier-dashboard.html";
         // Clears the form for the next product
      })
      .catch((error) => {
        // This part runs if there was an error
        console.error("Error adding product: ", error);
        // The most common error here is "Missing or insufficient permissions"
        // which means your Firestore Security Rules need to be updated.
        alert("Error adding product. Please check the console for details.");

      });
  });

  // 6. Handle logout
  document.getElementById("logoutBtn").addEventListener("click", (e) => {
    e.preventDefault();
    auth.signOut().then(() => window.location.href = "index.html");
  });
</script>

</body>
</html>
